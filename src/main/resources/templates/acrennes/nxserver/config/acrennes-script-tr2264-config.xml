<?xml version="1.0"?>
<component name="fr.toutatice.script.migrate.agendas.config">

	<require>org.nuxeo.ecm.core.operation.OperationServiceComponent</require>

	<extension target="org.nuxeo.ecm.core.operation.OperationServiceComponent" point="chains">

		<chain id="TR2264">
			<operation id="Context.FetchDocument"/>
			<operation id="Context.SetVar">
				<param type="string" name="name">title</param>
				<param type="object" name="value">expr:Document.getProperty("dc:title")</param>
			</operation>
			<operation id="Context.SetVar">
				<param type="string" name="name">description</param>
				<param type="object" name="value">expr:Document.getProperty("dc:description")</param>
			</operation>
			<operation id="Document.GetFilteredDocumentACEs">
				<param type="string" name="aclName">local</param>
				<param type="string" name="variable name">ACLlocal</param>
			</operation>
			<operation id="Document.Push"/>
			<operation id="Document.GetParent"/>
			<operation id="Document.Create">
				<param type="string" name="type">Agenda</param>
				<param type="string" name="name">calendar</param>
				<param type="properties" name="properties">expr:dc:title=@{Context["title"]}
dc:description=@{Context["description"]}</param>
			</operation>
			<operation id="Document.SetACL">
				<param type="string" name="entries">expr:@{Context["ACLlocal"]}</param>
				<param type="string" name="acl">local</param>
				<param type="boolean" name="break">false</param>
				<param type="boolean" name="overwrite">true</param>
			</operation>
			<operation id="Context.SetInputAsVar">
				<param type="string" name="name">calendar</param>
			</operation>
			<operation id="Document.Pop"/>
			<operation id="Document.Delete"/>
		</chain>

		<chain id="TR2264-SOL">
			<operation id="Context.FetchDocument"/>
			<operation id="Document.SetOnLineOperation" />
		</chain>

	</extension>

</component>

