<?xml version="1.0"?>
<component name="fr.toutatice.script.migrate.ACL.config">

	<require>org.nuxeo.ecm.core.operation.OperationServiceComponent</require>

	<extension target="org.nuxeo.ecm.core.operation.OperationServiceComponent" point="chains">

		<chain id="TR2457-LER">
			<operation id="Context.FetchDocument"/>
			<operation id="Context.SetVar">
				<param type="string" name="name">creator</param>
				<param type="object" name="value">expr:Document.getProperty("dc:creator")</param>
			</operation>
			<operation id="Document.Push"/>
			<operation id="Document.GetParent"/>
			<operation id="Document.GetFilteredDocumentACEs">
				<param type="string" name="aclName">*</param>
				<param type="string" name="permissionExcluded">le_contribute</param>
				<param type="string" name="variable name">docACP</param>
			</operation>
			<operation id="Document.Pop"/>
			<operation id="Document.SetACL">
				<param type="string" name="entries">expr:@{Context["creator"]}:le_contribute:true,@{Context["docACP"]}</param>
				<param type="string" name="acl">local</param>
				<param type="boolean" name="break">true</param>
				<param type="boolean" name="overwrite">true</param>
			</operation>
		</chain>

		<chain id="TR2457-AFTER-BREAK">
			<operation id="Context.FetchDocument"/>
			<operation id="Document.GetFilteredDocumentACEs">
				<param type="string" name="aclName">*</param>
				<param type="string" name="permissionExcluded"></param>
				<param type="string" name="variable name">docACP</param>
			</operation>
			<operation id="Document.SetACL">
				<param type="string" name="entries">expr:@{Context["docACP"]}</param>
				<param type="string" name="acl">local</param>
				<param type="boolean" name="break">true</param>
				<param type="boolean" name="overwrite">true</param>
			</operation>
		</chain>

	</extension>

</component>
